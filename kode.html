<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Absensi Digital - INFORMATIKA SMPN SATAP 01 DENTE TELADAS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .status-hadir { background: linear-gradient(135deg, #10b981, #059669); }
        .status-sakit { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .status-izin { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .status-alfa { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .calendar-day { transition: all 0.2s ease; }
        .calendar-day:hover { background-color: #dbeafe; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center space-x-4 mb-4 md:mb-0">
                    <div class="bg-white p-3 rounded-full">
                        <i class="fas fa-graduation-cap text-blue-600 text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl md:text-2xl font-bold">INFORMATIKA SMPN SATAP 01</h1>
                        <p class="text-blue-100">DENTE TELADAS</p>
                    </div>
                </div>
                <div class="text-center md:text-right">
                    <div id="currentTime" class="text-2xl font-bold"></div>
                    <div id="currentDate" class="text-blue-100"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center space-x-2 md:space-x-6 py-4">
                <button onclick="showSection('dashboard')" class="nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </button>
                <button onclick="showSection('kelas7')" class="nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                    <i class="fas fa-users mr-2"></i>Kelas 7
                </button>
                <button onclick="showSection('kelas8')" class="nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                    <i class="fas fa-users mr-2"></i>Kelas 8
                </button>
                <button onclick="showSection('kelas9')" class="nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                    <i class="fas fa-users mr-2"></i>Kelas 9
                </button>
                <button onclick="showSection('penilaian')" class="nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                    <i class="fas fa-star mr-2"></i>Penilaian
                </button>
                <button onclick="showSection('admin')" class="nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                    <i class="fas fa-cog mr-2"></i>Admin
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Dashboard Section -->
        <div id="dashboard" class="section animate-fade-in">
            <!-- Total Siswa Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-users text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-gray-500 text-sm">Total Siswa</h3>
                            <p class="text-2xl font-bold text-gray-800" id="totalStudents">0</p>
                            <p class="text-xs text-gray-400">Semua Kelas</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-indigo-100 p-3 rounded-full">
                            <i class="fas fa-graduation-cap text-indigo-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-gray-500 text-sm">Kelas 7</h3>
                            <p class="text-2xl font-bold text-gray-800" id="kelas7Total">0</p>
                            <p class="text-xs text-gray-400">siswa</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-graduation-cap text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-gray-500 text-sm">Kelas 8</h3>
                            <p class="text-2xl font-bold text-gray-800" id="kelas8Total">0</p>
                            <p class="text-xs text-gray-400">siswa</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                    <div class="flex items-center">
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-graduation-cap text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="text-gray-500 text-sm">Kelas 9</h3>
                            <p class="text-2xl font-bold text-gray-800" id="kelas9Total">0</p>
                            <p class="text-xs text-gray-400">siswa</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Persentase Kehadiran Total -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-chart-pie text-green-600 mr-2"></i>Persentase Kehadiran Total
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6">
                    <div class="text-center">
                        <div class="bg-green-100 p-4 rounded-full w-20 h-20 mx-auto mb-3 flex items-center justify-center">
                            <i class="fas fa-check text-green-600 text-2xl"></i>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600">Hadir Hari Ini</h3>
                        <p class="text-2xl font-bold text-green-600" id="todayPresent">0</p>
                        <p class="text-xs text-gray-400" id="todayPresentPercent">0%</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-yellow-100 p-4 rounded-full w-20 h-20 mx-auto mb-3 flex items-center justify-center">
                            <i class="fas fa-thermometer-half text-yellow-600 text-2xl"></i>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600">Sakit</h3>
                        <p class="text-2xl font-bold text-yellow-600" id="todaySick">0</p>
                        <p class="text-xs text-gray-400" id="todaySickPercent">0%</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-blue-100 p-4 rounded-full w-20 h-20 mx-auto mb-3 flex items-center justify-center">
                            <i class="fas fa-hand-paper text-blue-600 text-2xl"></i>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600">Izin</h3>
                        <p class="text-2xl font-bold text-blue-600" id="todayPermit">0</p>
                        <p class="text-xs text-gray-400" id="todayPermitPercent">0%</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-red-100 p-4 rounded-full w-20 h-20 mx-auto mb-3 flex items-center justify-center">
                            <i class="fas fa-times text-red-600 text-2xl"></i>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600">Alfa</h3>
                        <p class="text-2xl font-bold text-red-600" id="todayAlfa">0</p>
                        <p class="text-xs text-gray-400" id="todayAlfaPercent">0%</p>
                    </div>
                    <div class="text-center">
                        <div class="bg-gray-100 p-4 rounded-full w-20 h-20 mx-auto mb-3 flex items-center justify-center">
                            <i class="fas fa-question text-gray-600 text-2xl"></i>
                        </div>
                        <h3 class="text-sm font-medium text-gray-600">Belum Absen</h3>
                        <p class="text-2xl font-bold text-gray-600" id="todayNotMarked">0</p>
                        <p class="text-xs text-gray-400" id="todayNotMarkedPercent">0%</p>
                    </div>
                </div>
                <div class="mt-6 bg-gray-50 rounded-lg p-4">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-medium text-gray-600">Tingkat Kehadiran Keseluruhan:</span>
                        <span class="text-lg font-bold text-green-600" id="overallAttendanceRate">0%</span>
                    </div>
                    <div class="mt-2 bg-gray-200 rounded-full h-3">
                        <div id="attendanceProgressBar" class="bg-green-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Statistik Penilaian -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-star text-yellow-500 mr-2"></i>Statistik Penilaian Informatika
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-blue-100">Total Penilaian</h3>
                                <p class="text-2xl font-bold" id="totalGrades">0</p>
                                <p class="text-xs text-blue-200">data nilai</p>
                            </div>
                            <i class="fas fa-clipboard-list text-3xl text-blue-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-green-100">Rata-rata Kelas</h3>
                                <p class="text-2xl font-bold" id="dashboardClassAverage">0</p>
                                <p class="text-xs text-green-200">semua kelas</p>
                            </div>
                            <i class="fas fa-chart-line text-3xl text-green-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-yellow-100">Nilai Tertinggi</h3>
                                <p class="text-2xl font-bold" id="dashboardHighestGrade">0</p>
                                <p class="text-xs text-yellow-200">maksimal</p>
                            </div>
                            <i class="fas fa-trophy text-3xl text-yellow-200"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-sm font-medium text-purple-100">Siswa Berprestasi</h3>
                                <p class="text-2xl font-bold" id="topStudents">0</p>
                                <p class="text-xs text-purple-200">nilai ≥ 90</p>
                            </div>
                            <i class="fas fa-medal text-3xl text-purple-200"></i>
                        </div>
                    </div>
                </div>
                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <h4 class="text-sm font-medium text-gray-600 mb-2">Kelas 7</h4>
                        <p class="text-lg font-bold text-gray-800" id="grade7Average">-</p>
                        <p class="text-xs text-gray-500">rata-rata</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <h4 class="text-sm font-medium text-gray-600 mb-2">Kelas 8</h4>
                        <p class="text-lg font-bold text-gray-800" id="grade8Average">-</p>
                        <p class="text-xs text-gray-500">rata-rata</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <h4 class="text-sm font-medium text-gray-600 mb-2">Kelas 9</h4>
                        <p class="text-lg font-bold text-gray-800" id="grade9Average">-</p>
                        <p class="text-xs text-gray-500">rata-rata</p>
                    </div>
                </div>
            </div>

            <!-- Aksi Cepat -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-bolt text-yellow-500 mr-2"></i>Aksi Cepat
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
                    <button onclick="showSection('kelas7')" class="bg-blue-50 hover:bg-blue-100 p-4 rounded-lg text-center transition-colors group">
                        <i class="fas fa-user-plus text-blue-600 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <p class="text-sm font-medium text-gray-700">Tambah Siswa</p>
                    </button>
                    <button onclick="markAttendance()" class="bg-green-50 hover:bg-green-100 p-4 rounded-lg text-center transition-colors group">
                        <i class="fas fa-check-circle text-green-600 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <p class="text-sm font-medium text-gray-700">Absen Hari Ini</p>
                    </button>
                    <button onclick="showSection('penilaian')" class="bg-yellow-50 hover:bg-yellow-100 p-4 rounded-lg text-center transition-colors group">
                        <i class="fas fa-star text-yellow-600 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <p class="text-sm font-medium text-gray-700">Input Nilai</p>
                    </button>
                    <button onclick="showSection('admin')" class="bg-purple-50 hover:bg-purple-100 p-4 rounded-lg text-center transition-colors group">
                        <i class="fas fa-chart-bar text-purple-600 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <p class="text-sm font-medium text-gray-700">Lihat Statistik</p>
                    </button>
                    <button onclick="exportData()" class="bg-orange-50 hover:bg-orange-100 p-4 rounded-lg text-center transition-colors group">
                        <i class="fas fa-download text-orange-600 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <p class="text-sm font-medium text-gray-700">Export Data</p>
                    </button>
                    <button onclick="openModal('helpModal')" class="bg-indigo-50 hover:bg-indigo-100 p-4 rounded-lg text-center transition-colors group">
                        <i class="fas fa-question-circle text-indigo-600 text-2xl mb-2 group-hover:scale-110 transition-transform"></i>
                        <p class="text-sm font-medium text-gray-700">Bantuan</p>
                    </button>
                </div>
            </div>

            <!-- Kalender -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-calendar text-blue-600 mr-2"></i>Kalender Absensi
                    </h2>
                    <div class="flex items-center space-x-4">
                        <button onclick="changeMonth(-1)" class="bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition-colors">
                            <i class="fas fa-chevron-left text-gray-600"></i>
                        </button>
                        <span id="currentMonth" class="text-lg font-semibold text-gray-800"></span>
                        <button onclick="changeMonth(1)" class="bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition-colors">
                            <i class="fas fa-chevron-right text-gray-600"></i>
                        </button>
                    </div>
                </div>
                <div id="calendar" class="grid grid-cols-7 gap-2"></div>
                <div class="mt-4 flex flex-wrap justify-center gap-4 text-xs">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                        <span class="text-gray-600">Kehadiran Tinggi (≥80%)</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                        <span class="text-gray-600">Kehadiran Sedang (60-79%)</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                        <span class="text-gray-600">Kehadiran Rendah (<60%)</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Class Sections (7, 8, 9) -->
        <div id="kelas7" class="section hidden animate-fade-in">
            <div class="class-section" data-class="7"></div>
        </div>
        <div id="kelas8" class="section hidden animate-fade-in">
            <div class="class-section" data-class="8"></div>
        </div>
        <div id="kelas9" class="section hidden animate-fade-in">
            <div class="class-section" data-class="9"></div>
        </div>

        <!-- Penilaian Section -->
        <div id="penilaian" class="section hidden animate-fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-star text-yellow-500 mr-2"></i>Sistem Penilaian Informatika
                </h2>
                
                <!-- Filter Controls -->
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <select id="gradeClass" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Pilih Kelas</option>
                            <option value="7">Kelas 7</option>
                            <option value="8">Kelas 8</option>
                            <option value="9">Kelas 9</option>
                        </select>
                        <select id="gradeType" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Semua Jenis Penilaian</option>
                            <option value="Tugas Harian">Tugas Harian</option>
                            <option value="Ulangan Harian">Ulangan Harian</option>
                            <option value="UTS">UTS</option>
                            <option value="UAS">UAS</option>
                            <option value="Praktik">Praktik</option>
                            <option value="Proyek">Proyek</option>
                        </select>
                        <button onclick="loadGradeData()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-search mr-2"></i>Tampilkan Nilai Informatika
                        </button>
                    </div>
                </div>

                <!-- Add Grade Button -->
                <div class="mb-6">
                    <button onclick="openModal('addGradeModal')" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                        <i class="fas fa-plus mr-2"></i>Tambah Nilai Baru
                    </button>
                </div>

                <!-- Grades Table -->
                <div id="gradesTable" class="overflow-x-auto">
                    <div class="text-center py-12">
                        <i class="fas fa-clipboard-list text-gray-300 text-6xl mb-4"></i>
                        <p class="text-gray-500 text-lg">Pilih kelas dan mata pelajaran untuk melihat nilai</p>
                    </div>
                </div>
            </div>

            <!-- Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Rata-rata Kelas</h3>
                    <div class="text-3xl font-bold text-blue-600" id="classAverage">-</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Nilai Tertinggi</h3>
                    <div class="text-3xl font-bold text-green-600" id="highestGrade">-</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Nilai Terendah</h3>
                    <div class="text-3xl font-bold text-red-600" id="lowestGrade">-</div>
                </div>
            </div>
        </div>

        <!-- Admin Section -->
        <div id="admin" class="section hidden animate-fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-shield-alt text-blue-600 mr-2"></i>Panel Admin
                </h2>
                
                <!-- Admin Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Kelas 7</h3>
                        <p class="text-3xl font-bold" id="adminKelas7Count">0</p>
                        <p class="text-blue-100">siswa terdaftar</p>
                    </div>
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Kelas 8</h3>
                        <p class="text-3xl font-bold" id="adminKelas8Count">0</p>
                        <p class="text-green-100">siswa terdaftar</p>
                    </div>
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6 rounded-lg">
                        <h3 class="text-lg font-semibold mb-2">Kelas 9</h3>
                        <p class="text-3xl font-bold" id="adminKelas9Count">0</p>
                        <p class="text-purple-100">siswa terdaftar</p>
                    </div>
                </div>

                <!-- Export Options -->
                <div class="bg-gray-50 p-6 rounded-lg mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Export Data</h3>
                    <div class="flex flex-wrap gap-4">
                        <button onclick="exportToPDF('all')" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-file-pdf mr-2"></i>Export PDF
                        </button>
                        <button onclick="exportToExcel('all')" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-file-excel mr-2"></i>Export Excel
                        </button>
                        <select id="exportPeriod" class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="month">Bulan Ini</option>
                            <option value="semester">Semester</option>
                            <option value="year">Tahun Ini</option>
                        </select>
                    </div>
                </div>

                <!-- Admin Data View -->
                <div id="adminDataView"></div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <!-- Add Student Modal -->
    <div id="addStudentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Siswa Baru</h3>
            <form id="addStudentForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">NISN</label>
                    <input type="text" id="studentNISN" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Nama Siswa</label>
                    <input type="text" id="studentName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Jenis Kelamin</label>
                    <select id="studentGender" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                        <option value="">Pilih Jenis Kelamin</option>
                        <option value="L">Laki-laki</option>
                        <option value="P">Perempuan</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Tempat, Tanggal Lahir</label>
                    <input type="text" id="studentTTL" placeholder="Contoh: Jakarta, 15 Januari 2010" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="flex space-x-4">
                    <button type="button" onclick="closeModal('addStudentModal')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">
                        Tambah Siswa
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Grade Modal -->
    <div id="addGradeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 max-h-96 overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Nilai Baru</h3>
            <form id="addGradeForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Kelas</label>
                        <select id="newGradeClass" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Pilih Kelas</option>
                            <option value="7">Kelas 7</option>
                            <option value="8">Kelas 8</option>
                            <option value="9">Kelas 9</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Mata Pelajaran</label>
                        <div class="px-4 py-3 border border-gray-300 rounded-lg bg-blue-50 text-blue-800 font-medium">
                            <i class="fas fa-laptop-code mr-2"></i>Informatika
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Jenis Penilaian</label>
                        <select id="newGradeType" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Pilih Jenis</option>
                            <option value="Tugas Harian">Tugas Harian</option>
                            <option value="Ulangan Harian">Ulangan Harian</option>
                            <option value="UTS">UTS</option>
                            <option value="UAS">UAS</option>
                            <option value="Praktik">Praktik</option>
                            <option value="Proyek">Proyek</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-medium mb-2">Tanggal</label>
                        <input type="date" id="newGradeDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Deskripsi/Judul</label>
                    <input type="text" id="newGradeDescription" placeholder="Contoh: Ulangan Harian Bab 1" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div id="studentsGradeList" class="mb-6">
                    <p class="text-gray-500 text-center py-4">Pilih kelas untuk menampilkan daftar siswa</p>
                </div>
                <div class="flex space-x-4">
                    <button type="button" onclick="closeModal('addGradeModal')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium transition-colors">
                        Simpan Nilai
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Grade Modal -->
    <div id="editGradeModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Edit Nilai</h3>
            <form id="editGradeForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Nama Siswa</label>
                    <input type="text" id="editStudentName" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Nilai (0-100)</label>
                    <input type="number" id="editGradeValue" min="0" max="100" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-medium mb-2">Catatan</label>
                    <textarea id="editGradeNote" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Catatan tambahan (opsional)"></textarea>
                </div>
                <div class="flex space-x-4">
                    <button type="button" onclick="closeModal('editGradeModal')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-3 rounded-lg font-medium transition-colors">
                        Batal
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">
                        Update Nilai
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 max-h-96 overflow-y-auto">
            <h3 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-question-circle text-blue-600 mr-2"></i>Bantuan Sistem Absensi
            </h3>
            <div class="space-y-4">
                <div>
                    <h4 class="font-semibold text-gray-700">Cara Menambah Siswa:</h4>
                    <p class="text-gray-600">1. Pilih kelas yang diinginkan<br>2. Klik tombol "Tambah Siswa"<br>3. Isi data lengkap siswa<br>4. Klik "Tambah Siswa"</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700">Cara Absen:</h4>
                    <p class="text-gray-600">1. Pilih kelas<br>2. Klik nama siswa<br>3. Pilih status kehadiran<br>4. Data otomatis tersimpan</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700">Cara Input Nilai:</h4>
                    <p class="text-gray-600">1. Masuk ke menu Penilaian<br>2. Klik "Tambah Nilai Baru"<br>3. Pilih kelas, mata pelajaran, dan jenis penilaian<br>4. Input nilai untuk setiap siswa<br>5. Klik "Simpan Nilai"</p>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-700">Export Data:</h4>
                    <p class="text-gray-600">Admin dapat mengexport data absensi dan nilai dalam format PDF atau Excel melalui panel admin</p>
                </div>
            </div>
            <button onclick="closeModal('helpModal')" class="mt-6 w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition-colors">
                Tutup
            </button>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-6 right-6 space-y-4">
        <button onclick="openModal('helpModal')" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg transition-all hover:scale-110">
            <i class="fas fa-question text-xl"></i>
        </button>
    </div>

    <script>
        // Global variables
        let currentClass = '';
        let currentGradeId = null;
        let students = {
            7: JSON.parse(localStorage.getItem('students7')) || [],
            8: JSON.parse(localStorage.getItem('students8')) || [],
            9: JSON.parse(localStorage.getItem('students9')) || []
        };
        let attendance = JSON.parse(localStorage.getItem('attendance')) || {};
        let grades = JSON.parse(localStorage.getItem('grades')) || [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            generateCalendar();
            updateDashboardStats();
            renderAllClassSections();
            renderAdminSection();
        });

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('id-ID', timeOptions);
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', dateOptions);
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.className = 'nav-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors';
            });
            event.target.className = 'nav-btn bg-blue-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-blue-700 transition-colors';
        }

        // Generate calendar
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            
            // Calendar header
            const daysOfWeek = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            calendar.innerHTML = '';
            
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 py-2';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Calendar days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                calendar.appendChild(emptyDay);
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day text-center py-2 cursor-pointer rounded-lg';
                dayElement.textContent = day;
                
                if (day === now.getDate()) {
                    dayElement.className += ' bg-blue-600 text-white font-bold';
                }
                
                calendar.appendChild(dayElement);
            }
        }

        // Modal functions
        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Add student form
        document.getElementById('addStudentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const nisn = document.getElementById('studentNISN').value;
            const name = document.getElementById('studentName').value;
            const gender = document.getElementById('studentGender').value;
            const ttl = document.getElementById('studentTTL').value;
            
            const newStudent = {
                id: Date.now(),
                nisn: nisn,
                name: name,
                gender: gender,
                ttl: ttl,
                class: currentClass
            };
            
            students[currentClass].push(newStudent);
            saveStudents();
            renderClassSection(currentClass);
            updateDashboardStats();
            renderAdminSection();
            
            // Reset form and close modal
            this.reset();
            closeModal('addStudentModal');
            
            alert('Siswa berhasil ditambahkan!');
        });

        // Save students to localStorage
        function saveStudents() {
            localStorage.setItem(`students7`, JSON.stringify(students[7]));
            localStorage.setItem(`students8`, JSON.stringify(students[8]));
            localStorage.setItem(`students9`, JSON.stringify(students[9]));
        }

        // Save attendance to localStorage
        function saveAttendance() {
            localStorage.setItem('attendance', JSON.stringify(attendance));
        }

        // Render all class sections
        function renderAllClassSections() {
            [7, 8, 9].forEach(classNum => {
                renderClassSection(classNum);
            });
        }

        // Render class section
        function renderClassSection(classNum) {
            const container = document.querySelector(`[data-class="${classNum}"]`);
            const classStudents = students[classNum] || [];
            
            container.innerHTML = `
                <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">
                            <i class="fas fa-users text-blue-600 mr-2"></i>Kelas ${classNum}
                        </h2>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="currentClass=${classNum}; openModal('addStudentModal')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-user-plus mr-2"></i>Tambah Siswa
                            </button>
                            <button onclick="exportToPDF(${classNum})" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-file-pdf mr-2"></i>PDF
                            </button>
                            <button onclick="exportToExcel(${classNum})" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                <i class="fas fa-file-excel mr-2"></i>Excel
                            </button>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="studentsGrid${classNum}">
                        ${classStudents.map(student => `
                            <div class="bg-gray-50 rounded-lg p-4 card-hover">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="font-semibold text-gray-800">${student.name}</h3>
                                        <p class="text-sm text-gray-600">NISN: ${student.nisn}</p>
                                        <p class="text-sm text-gray-600">${student.gender === 'L' ? 'Laki-laki' : 'Perempuan'}</p>
                                        <p class="text-sm text-gray-600">${student.ttl}</p>
                                    </div>
                                    <button onclick="deleteStudent(${classNum}, ${student.id})" class="text-red-500 hover:text-red-700 transition-colors">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                                
                                <div class="space-y-2">
                                    <p class="text-sm font-medium text-gray-700">Status Hari Ini:</p>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="markStudentAttendance(${student.id}, 'hadir')" class="status-hadir text-white text-xs py-2 px-3 rounded-lg font-medium transition-colors hover:opacity-90">
                                            Hadir
                                        </button>
                                        <button onclick="markStudentAttendance(${student.id}, 'sakit')" class="status-sakit text-white text-xs py-2 px-3 rounded-lg font-medium transition-colors hover:opacity-90">
                                            Sakit
                                        </button>
                                        <button onclick="markStudentAttendance(${student.id}, 'izin')" class="status-izin text-white text-xs py-2 px-3 rounded-lg font-medium transition-colors hover:opacity-90">
                                            Izin
                                        </button>
                                        <button onclick="markStudentAttendance(${student.id}, 'alfa')" class="status-alfa text-white text-xs py-2 px-3 rounded-lg font-medium transition-colors hover:opacity-90">
                                            Alfa
                                        </button>
                                    </div>
                                    <div class="mt-2 text-center">
                                        <span class="text-xs px-2 py-1 rounded-full ${getStatusBadgeClass(getTodayAttendance(student.id))}">
                                            ${getTodayAttendance(student.id) || 'Belum Absen'}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    ${classStudents.length === 0 ? `
                        <div class="text-center py-12">
                            <i class="fas fa-user-plus text-gray-300 text-6xl mb-4"></i>
                            <p class="text-gray-500 text-lg">Belum ada siswa di kelas ini</p>
                            <p class="text-gray-400">Klik "Tambah Siswa" untuk memulai</p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Delete student
        function deleteStudent(classNum, studentId) {
            if (confirm('Apakah Anda yakin ingin menghapus siswa ini?')) {
                students[classNum] = students[classNum].filter(student => student.id !== studentId);
                saveStudents();
                renderClassSection(classNum);
                updateDashboardStats();
                renderAdminSection();
                alert('Siswa berhasil dihapus!');
            }
        }

        // Mark student attendance
        function markStudentAttendance(studentId, status) {
            const today = new Date().toISOString().split('T')[0];
            if (!attendance[today]) {
                attendance[today] = {};
            }
            attendance[today][studentId] = status;
            saveAttendance();
            updateDashboardStats();
            renderAllClassSections();
            renderAdminSection();
        }

        // Get today's attendance for a student
        function getTodayAttendance(studentId) {
            const today = new Date().toISOString().split('T')[0];
            return attendance[today] && attendance[today][studentId];
        }

        // Get status badge class
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'hadir': return 'bg-green-100 text-green-800';
                case 'sakit': return 'bg-yellow-100 text-yellow-800';
                case 'izin': return 'bg-purple-100 text-purple-800';
                case 'alfa': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const totalStudents = students[7].length + students[8].length + students[9].length;
            const today = new Date().toISOString().split('T')[0];
            const todayAttendance = attendance[today] || {};
            
            let presentCount = 0;
            let sickCount = 0;
            let permitCount = 0;
            let alfaCount = 0;
            let notMarkedCount = 0;
            
            // Count attendance by status
            Object.values(todayAttendance).forEach(status => {
                switch(status) {
                    case 'hadir': presentCount++; break;
                    case 'sakit': sickCount++; break;
                    case 'izin': permitCount++; break;
                    case 'alfa': alfaCount++; break;
                }
            });
            
            // Calculate not marked (students without attendance record today)
            const allStudentIds = [];
            [7, 8, 9].forEach(classNum => {
                students[classNum].forEach(student => {
                    allStudentIds.push(student.id);
                });
            });
            
            notMarkedCount = allStudentIds.filter(id => !todayAttendance[id]).length;
            
            const attendanceRate = totalStudents > 0 ? Math.round((presentCount / totalStudents) * 100) : 0;
            
            // Update total students
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('kelas7Total').textContent = students[7].length;
            document.getElementById('kelas8Total').textContent = students[8].length;
            document.getElementById('kelas9Total').textContent = students[9].length;
            
            // Update attendance stats
            document.getElementById('todayPresent').textContent = presentCount;
            document.getElementById('todaySick').textContent = sickCount;
            document.getElementById('todayPermit').textContent = permitCount;
            document.getElementById('todayAlfa').textContent = alfaCount;
            document.getElementById('todayNotMarked').textContent = notMarkedCount;
            
            // Update percentages
            if (totalStudents > 0) {
                document.getElementById('todayPresentPercent').textContent = Math.round((presentCount / totalStudents) * 100) + '%';
                document.getElementById('todaySickPercent').textContent = Math.round((sickCount / totalStudents) * 100) + '%';
                document.getElementById('todayPermitPercent').textContent = Math.round((permitCount / totalStudents) * 100) + '%';
                document.getElementById('todayAlfaPercent').textContent = Math.round((alfaCount / totalStudents) * 100) + '%';
                document.getElementById('todayNotMarkedPercent').textContent = Math.round((notMarkedCount / totalStudents) * 100) + '%';
            }
            
            document.getElementById('overallAttendanceRate').textContent = attendanceRate + '%';
            document.getElementById('attendanceProgressBar').style.width = attendanceRate + '%';
            
            // Update grade statistics
            updateDashboardGradeStats();
        }
        
        // Update dashboard grade statistics
        function updateDashboardGradeStats() {
            const totalGrades = grades.length;
            let allGradeValues = [];
            let topStudentsCount = 0;
            
            // Collect all grade values
            grades.forEach(gradeEntry => {
                gradeEntry.studentGrades.forEach(sg => {
                    allGradeValues.push(sg.grade);
                    if (sg.grade >= 90) topStudentsCount++;
                });
            });
            
            // Calculate overall statistics
            const overallAverage = allGradeValues.length > 0 
                ? (allGradeValues.reduce((sum, grade) => sum + grade, 0) / allGradeValues.length).toFixed(1)
                : 0;
            const highestGrade = allGradeValues.length > 0 ? Math.max(...allGradeValues) : 0;
            
            // Update dashboard grade stats
            document.getElementById('totalGrades').textContent = totalGrades;
            document.getElementById('dashboardClassAverage').textContent = overallAverage;
            document.getElementById('dashboardHighestGrade').textContent = highestGrade;
            document.getElementById('topStudents').textContent = topStudentsCount;
            
            // Calculate class averages
            [7, 8, 9].forEach(classNum => {
                const classGrades = grades.filter(g => g.class == classNum);
                let classGradeValues = [];
                
                classGrades.forEach(gradeEntry => {
                    gradeEntry.studentGrades.forEach(sg => {
                        classGradeValues.push(sg.grade);
                    });
                });
                
                const classAverage = classGradeValues.length > 0 
                    ? (classGradeValues.reduce((sum, grade) => sum + grade, 0) / classGradeValues.length).toFixed(1)
                    : '-';
                
                document.getElementById(`grade${classNum}Average`).textContent = classAverage;
            });
        }
        
        // Calendar variables
        let currentCalendarDate = new Date();
        
        // Generate enhanced calendar
        function generateCalendar() {
            const calendar = document.getElementById('calendar');
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Update month display
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                               'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Calendar header
            const daysOfWeek = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            calendar.innerHTML = '';
            
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'text-center font-semibold text-gray-600 py-2 text-sm';
                dayHeader.textContent = day;
                calendar.appendChild(dayHeader);
            });
            
            // Calendar days
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();
            
            // Empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                calendar.appendChild(emptyDay);
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayAttendance = attendance[dateStr] || {};
                
                // Calculate attendance rate for this day
                const totalStudents = students[7].length + students[8].length + students[9].length;
                const presentCount = Object.values(dayAttendance).filter(status => status === 'hadir').length;
                const attendanceRate = totalStudents > 0 ? (presentCount / totalStudents) * 100 : 0;
                
                // Set day styling based on attendance rate
                let dayClass = 'calendar-day text-center py-3 cursor-pointer rounded-lg text-sm font-medium transition-all hover:scale-105';
                
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayClass += ' bg-blue-600 text-white font-bold ring-2 ring-blue-300';
                } else if (Object.keys(dayAttendance).length > 0) {
                    if (attendanceRate >= 80) {
                        dayClass += ' bg-green-100 text-green-800 border border-green-300';
                    } else if (attendanceRate >= 60) {
                        dayClass += ' bg-yellow-100 text-yellow-800 border border-yellow-300';
                    } else {
                        dayClass += ' bg-red-100 text-red-800 border border-red-300';
                    }
                } else {
                    dayClass += ' hover:bg-gray-100 text-gray-600';
                }
                
                dayElement.className = dayClass;
                dayElement.innerHTML = `
                    <div>${day}</div>
                    ${Object.keys(dayAttendance).length > 0 ? 
                        `<div class="text-xs mt-1">${Math.round(attendanceRate)}%</div>` : 
                        ''
                    }
                `;
                
                // Add click event to show day details
                dayElement.onclick = () => showDayDetails(dateStr);
                
                calendar.appendChild(dayElement);
            }
        }
        
        // Change calendar month
        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            generateCalendar();
        }
        
        // Show day attendance details
        function showDayDetails(dateStr) {
            const dayAttendance = attendance[dateStr] || {};
            const date = new Date(dateStr);
            const formattedDate = date.toLocaleDateString('id-ID', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            if (Object.keys(dayAttendance).length === 0) {
                alert(`Tidak ada data absensi untuk ${formattedDate}`);
                return;
            }
            
            let detailHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="this.remove()">
                    <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 max-h-96 overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-800">Detail Absensi</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <p class="text-gray-600 mb-4">${formattedDate}</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            `;
            
            [7, 8, 9].forEach(classNum => {
                const classStudents = students[classNum] || [];
                detailHTML += `
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">Kelas ${classNum}</h4>
                        <div class="space-y-2">
                `;
                
                classStudents.forEach(student => {
                    const status = dayAttendance[student.id] || 'Belum Absen';
                    const statusClass = getStatusBadgeClass(status);
                    detailHTML += `
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-700">${student.name}</span>
                            <span class="px-2 py-1 rounded-full text-xs ${statusClass}">${status}</span>
                        </div>
                    `;
                });
                
                detailHTML += '</div></div>';
            });
            
            detailHTML += '</div></div></div>';
            document.body.insertAdjacentHTML('beforeend', detailHTML);
        }

        // Render admin section
        function renderAdminSection() {
            document.getElementById('adminKelas7Count').textContent = students[7].length;
            document.getElementById('adminKelas8Count').textContent = students[8].length;
            document.getElementById('adminKelas9Count').textContent = students[9].length;
            
            const adminDataView = document.getElementById('adminDataView');
            adminDataView.innerHTML = `
                <div class="space-y-6">
                    ${[7, 8, 9].map(classNum => `
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h3 class="text-lg font-semibold text-gray-800 mb-4">Kelas ${classNum} - ${students[classNum].length} Siswa</h3>
                            <div class="overflow-x-auto">
                                <table class="min-w-full bg-white rounded-lg shadow">
                                    <thead class="bg-gray-100">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">NISN</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">JK</th>
                                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Status Hari Ini</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${students[classNum].map(student => `
                                            <tr class="border-t">
                                                <td class="px-4 py-3 text-sm text-gray-600">${student.nisn}</td>
                                                <td class="px-4 py-3 text-sm font-medium text-gray-800">${student.name}</td>
                                                <td class="px-4 py-3 text-sm text-gray-600">${student.gender}</td>
                                                <td class="px-4 py-3">
                                                    <span class="text-xs px-2 py-1 rounded-full ${getStatusBadgeClass(getTodayAttendance(student.id))}">
                                                        ${getTodayAttendance(student.id) || 'Belum Absen'}
                                                    </span>
                                                </td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Export functions
        function exportToPDF(classNum) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.text('SISTEM ABSENSI DIGITAL', 20, 20);
            doc.text('INFORMATIKA SMPN SATAP 01 DENTE TELADAS', 20, 30);
            
            if (classNum === 'all') {
                doc.text('LAPORAN SEMUA KELAS', 20, 45);
            } else {
                doc.text(`LAPORAN KELAS ${classNum}`, 20, 45);
            }
            
            let yPosition = 60;
            const classesToExport = classNum === 'all' ? [7, 8, 9] : [classNum];
            
            classesToExport.forEach(cls => {
                doc.setFontSize(14);
                doc.text(`Kelas ${cls}`, 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(10);
                students[cls].forEach(student => {
                    const status = getTodayAttendance(student.id) || 'Belum Absen';
                    doc.text(`${student.nisn} - ${student.name} - ${status}`, 20, yPosition);
                    yPosition += 7;
                    
                    if (yPosition > 280) {
                        doc.addPage();
                        yPosition = 20;
                    }
                });
                yPosition += 10;
            });
            
            doc.save(`absensi-${classNum === 'all' ? 'semua-kelas' : 'kelas-' + classNum}.pdf`);
        }

        function exportToExcel(classNum) {
            const wb = XLSX.utils.book_new();
            const classesToExport = classNum === 'all' ? [7, 8, 9] : [classNum];
            
            classesToExport.forEach(cls => {
                const data = students[cls].map(student => ({
                    NISN: student.nisn,
                    Nama: student.name,
                    'Jenis Kelamin': student.gender === 'L' ? 'Laki-laki' : 'Perempuan',
                    'Tempat, Tanggal Lahir': student.ttl,
                    'Status Hari Ini': getTodayAttendance(student.id) || 'Belum Absen'
                }));
                
                const ws = XLSX.utils.json_to_sheet(data);
                XLSX.utils.book_append_sheet(wb, ws, `Kelas ${cls}`);
            });
            
            XLSX.writeFile(wb, `absensi-${classNum === 'all' ? 'semua-kelas' : 'kelas-' + classNum}.xlsx`);
        }

        // Grade Management Functions
        function saveGrades() {
            localStorage.setItem('grades', JSON.stringify(grades));
        }

        // Load students for grade input when class is selected
        document.getElementById('newGradeClass').addEventListener('change', function() {
            const selectedClass = this.value;
            const studentsGradeList = document.getElementById('studentsGradeList');
            
            if (selectedClass) {
                const classStudents = students[selectedClass] || [];
                if (classStudents.length > 0) {
                    studentsGradeList.innerHTML = `
                        <label class="block text-gray-700 text-sm font-medium mb-2">Input Nilai Siswa</label>
                        <div class="max-h-48 overflow-y-auto border border-gray-300 rounded-lg p-4 space-y-3">
                            ${classStudents.map(student => `
                                <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
                                    <div>
                                        <span class="font-medium text-gray-800">${student.name}</span>
                                        <span class="text-sm text-gray-600 ml-2">(${student.nisn})</span>
                                    </div>
                                    <input type="number" 
                                           id="grade_${student.id}" 
                                           min="0" max="100" 
                                           placeholder="0-100"
                                           class="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-center">
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    studentsGradeList.innerHTML = '<p class="text-gray-500 text-center py-4">Tidak ada siswa di kelas ini</p>';
                }
            } else {
                studentsGradeList.innerHTML = '<p class="text-gray-500 text-center py-4">Pilih kelas untuk menampilkan daftar siswa</p>';
            }
        });

        // Add grade form submission
        document.getElementById('addGradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const gradeClass = document.getElementById('newGradeClass').value;
            const subject = 'Informatika';
            const type = document.getElementById('newGradeType').value;
            const date = document.getElementById('newGradeDate').value;
            const description = document.getElementById('newGradeDescription').value;
            
            const classStudents = students[gradeClass] || [];
            const gradeData = {
                id: Date.now(),
                class: gradeClass,
                subject: subject,
                type: type,
                date: date,
                description: description,
                studentGrades: []
            };
            
            // Collect grades for each student
            classStudents.forEach(student => {
                const gradeInput = document.getElementById(`grade_${student.id}`);
                const gradeValue = gradeInput ? gradeInput.value : '';
                
                if (gradeValue !== '') {
                    gradeData.studentGrades.push({
                        studentId: student.id,
                        studentName: student.name,
                        studentNISN: student.nisn,
                        grade: parseInt(gradeValue),
                        note: ''
                    });
                }
            });
            
            grades.push(gradeData);
            saveGrades();
            
            // Reset form and close modal
            this.reset();
            document.getElementById('studentsGradeList').innerHTML = '<p class="text-gray-500 text-center py-4">Pilih kelas untuk menampilkan daftar siswa</p>';
            closeModal('addGradeModal');
            
            alert('Nilai berhasil disimpan!');
            
            // Refresh grade data if currently viewing
            const currentGradeClass = document.getElementById('gradeClass').value;
            if (currentGradeClass === gradeClass) {
                loadGradeData();
            }
        });

        // Edit grade form submission
        document.getElementById('editGradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newGrade = parseInt(document.getElementById('editGradeValue').value);
            const newNote = document.getElementById('editGradeNote').value;
            
            // Find and update the grade
            const gradeEntry = grades.find(g => g.id === currentGradeId);
            if (gradeEntry) {
                const studentGrade = gradeEntry.studentGrades.find(sg => sg.studentId === parseInt(document.getElementById('editStudentName').dataset.studentId));
                if (studentGrade) {
                    studentGrade.grade = newGrade;
                    studentGrade.note = newNote;
                    saveGrades();
                    closeModal('editGradeModal');
                    loadGradeData();
                    alert('Nilai berhasil diupdate!');
                }
            }
        });

        // Load and display grade data
        function loadGradeData() {
            const selectedClass = document.getElementById('gradeClass').value;
            const selectedSubject = document.getElementById('gradeSubject').value;
            const selectedType = document.getElementById('gradeType').value;
            
            if (!selectedClass) {
                document.getElementById('gradesTable').innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-clipboard-list text-gray-300 text-6xl mb-4"></i>
                        <p class="text-gray-500 text-lg">Pilih kelas untuk melihat nilai Informatika</p>
                    </div>
                `;
                return;
            }
            
            // Filter grades based on selection (automatically set to Informatika)
            let filteredGrades = grades.filter(g => 
                g.class === selectedClass && 
                g.subject === 'Informatika' &&
                (selectedType === '' || g.type === selectedType)
            );
            
            if (filteredGrades.length === 0) {
                document.getElementById('gradesTable').innerHTML = `
                    <div class="text-center py-12">
                        <i class="fas fa-clipboard-list text-gray-300 text-6xl mb-4"></i>
                        <p class="text-gray-500 text-lg">Belum ada data nilai untuk filter yang dipilih</p>
                        <button onclick="openModal('addGradeModal')" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            <i class="fas fa-plus mr-2"></i>Tambah Nilai Pertama
                        </button>
                    </div>
                `;
                updateGradeStatistics([]);
                return;
            }
            
            // Display grades in table format
            let tableHTML = `
                <table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Tanggal</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Jenis</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Deskripsi</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Rata-rata</th>
                            <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            filteredGrades.forEach(gradeEntry => {
                const average = gradeEntry.studentGrades.length > 0 
                    ? (gradeEntry.studentGrades.reduce((sum, sg) => sum + sg.grade, 0) / gradeEntry.studentGrades.length).toFixed(1)
                    : 0;
                
                tableHTML += `
                    <tr class="border-t hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm text-gray-600">${new Date(gradeEntry.date).toLocaleDateString('id-ID')}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${gradeEntry.type}</td>
                        <td class="px-4 py-3 text-sm font-medium text-gray-800">${gradeEntry.description}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${average}</td>
                        <td class="px-4 py-3 text-sm">
                            <button onclick="viewGradeDetails(${gradeEntry.id})" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-xs font-medium mr-2 transition-colors">
                                <i class="fas fa-eye mr-1"></i>Detail
                            </button>
                            <button onclick="deleteGrade(${gradeEntry.id})" class="bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded-lg text-xs font-medium transition-colors">
                                <i class="fas fa-trash mr-1"></i>Hapus
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += '</tbody></table>';
            document.getElementById('gradesTable').innerHTML = tableHTML;
            
            // Update statistics
            updateGradeStatistics(filteredGrades);
        }

        // View grade details
        function viewGradeDetails(gradeId) {
            const gradeEntry = grades.find(g => g.id === gradeId);
            if (!gradeEntry) return;
            
            let detailHTML = `
                <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="this.remove()">
                    <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full p-6 max-h-96 overflow-y-auto" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-bold text-gray-800">${gradeEntry.description}</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="mb-4">
                            <p class="text-gray-600">Kelas ${gradeEntry.class} - ${gradeEntry.subject} - ${gradeEntry.type}</p>
                            <p class="text-gray-600">Tanggal: ${new Date(gradeEntry.date).toLocaleDateString('id-ID')}</p>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-gray-50 rounded-lg">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">NISN</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nama Siswa</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Nilai</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Grade</th>
                                        <th class="px-4 py-3 text-left text-sm font-medium text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${gradeEntry.studentGrades.map(sg => `
                                        <tr class="border-t">
                                            <td class="px-4 py-3 text-sm text-gray-600">${sg.studentNISN}</td>
                                            <td class="px-4 py-3 text-sm font-medium text-gray-800">${sg.studentName}</td>
                                            <td class="px-4 py-3 text-sm">
                                                <span class="px-2 py-1 rounded-lg text-xs font-medium ${getGradeColor(sg.grade)}">
                                                    ${sg.grade}
                                                </span>
                                            </td>
                                            <td class="px-4 py-3 text-sm font-medium ${getGradeColor(sg.grade)}">${getGradeLetter(sg.grade)}</td>
                                            <td class="px-4 py-3 text-sm">
                                                <button onclick="editStudentGrade(${gradeEntry.id}, ${sg.studentId}, '${sg.studentName}', ${sg.grade}, '${sg.note || ''}')" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-1 rounded-lg text-xs font-medium transition-colors">
                                                    <i class="fas fa-edit mr-1"></i>Edit
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', detailHTML);
        }

        // Edit student grade
        function editStudentGrade(gradeId, studentId, studentName, currentGrade, currentNote) {
            currentGradeId = gradeId;
            document.getElementById('editStudentName').value = studentName;
            document.getElementById('editStudentName').dataset.studentId = studentId;
            document.getElementById('editGradeValue').value = currentGrade;
            document.getElementById('editGradeNote').value = currentNote;
            
            // Close detail modal first
            const detailModal = document.querySelector('.fixed.inset-0');
            if (detailModal) detailModal.remove();
            
            openModal('editGradeModal');
        }

        // Delete grade
        function deleteGrade(gradeId) {
            if (confirm('Apakah Anda yakin ingin menghapus data nilai ini?')) {
                grades = grades.filter(g => g.id !== gradeId);
                saveGrades();
                loadGradeData();
                alert('Data nilai berhasil dihapus!');
            }
        }

        // Update grade statistics
        function updateGradeStatistics(filteredGrades) {
            if (filteredGrades.length === 0) {
                document.getElementById('classAverage').textContent = '-';
                document.getElementById('highestGrade').textContent = '-';
                document.getElementById('lowestGrade').textContent = '-';
                return;
            }
            
            let allGrades = [];
            filteredGrades.forEach(gradeEntry => {
                gradeEntry.studentGrades.forEach(sg => {
                    allGrades.push(sg.grade);
                });
            });
            
            if (allGrades.length > 0) {
                const average = (allGrades.reduce((sum, grade) => sum + grade, 0) / allGrades.length).toFixed(1);
                const highest = Math.max(...allGrades);
                const lowest = Math.min(...allGrades);
                
                document.getElementById('classAverage').textContent = average;
                document.getElementById('highestGrade').textContent = highest;
                document.getElementById('lowestGrade').textContent = lowest;
            }
        }

        // Get grade color based on value
        function getGradeColor(grade) {
            if (grade >= 90) return 'bg-green-100 text-green-800';
            if (grade >= 80) return 'bg-blue-100 text-blue-800';
            if (grade >= 70) return 'bg-yellow-100 text-yellow-800';
            if (grade >= 60) return 'bg-orange-100 text-orange-800';
            return 'bg-red-100 text-red-800';
        }

        // Get grade letter
        function getGradeLetter(grade) {
            if (grade >= 90) return 'A';
            if (grade >= 80) return 'B';
            if (grade >= 70) return 'C';
            if (grade >= 60) return 'D';
            return 'E';
        }

        // Set default date to today
        document.getElementById('newGradeDate').valueAsDate = new Date();

        // Quick actions
        function markAttendance() {
            showSection('kelas7');
        }

        function exportData() {
            showSection('admin');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'973298a9441b514a',t:'MTc1NTg2ODA3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
